course_url<-c("https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ4JldLPTI%3d-ZF7UKQt6GfM%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ4JldLPTM%3d-j8U4kNlJYEo%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ4JldLPTQ%3d-zvkWye17HVo%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ4JldLPTU%3d-6mwLHYZFS2Q%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ4JldLPTY%3d-E2xnd6Yb00w%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ4JldLPTc%3d-ccJ6v9Rd0uU%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ4JldLPTE%3d-6D72Cgcw9EQ%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ1JldLPTI%3d-uTmCqCORZnk%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ1JldLPTM%3d-Fn2yD1B6YqA%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ1JldLPTQ%3d-Dy4Sy35bpdA%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ1JldLPTU%3d-7L6KZvSTTW0%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ1JldLPTY%3d-TtidJ9%2f5BSw%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ1JldLPTc%3d-IWM7wbP2P%2fs%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ1JldLPTE%3d-yFeJoem%2bXjA%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ2JldLPTI%3d-1aHX6AhNmsE%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ2JldLPTM%3d-Ujurez7A4%2fw%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ2JldLPTM%3d-Ujurez7A4%2fw%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ2JldLPTU%3d-VblM8s2zVWY%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ2JldLPTY%3d-rwsuqpmxwaQ%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ2JldLPTc%3d-WgmyTJ3EPTk%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ2JldLPTE%3d-N4aBucyD%2bMo%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQzJldLPTI%3d-T45L66VJxd0%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQzJldLPTM%3d-hEux3FOXezs%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQzJldLPTQ%3d-Wn5WYgsg8hI%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQzJldLPTU%3d-Jka97YJyGKc%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQzJldLPTY%3d-3PyAPim09wc%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQzJldLPTc%3d-XSZAP4jXChw%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQzJldLPTE%3d-MbE5Y2H6jCk%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ0JldLPTI%3d-nFnAs15sBNw%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ0JldLPTM%3d-Gzy9MzJpMwA%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ0JldLPTQ%3d-bG7GizYaH8U%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ0JldLPTU%3d-5PxxanO0QUQ%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ0JldLPTY%3d-4ANEjZa8iWk%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ0JldLPTc%3d-4gtnpb%2fxnLY%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQ0JldLPTE%3d-CaUNexBMo84%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQxJldLPTI%3d-IuloQ7bYz9Q%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQxJldLPTM%3d-y163%2bliZdBM%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQxJldLPTQ%3d-2%2fUpeIUWNI8%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQxJldLPTU%3d-CSHj8HIchPE%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQxJldLPTY%3d-FDggGwwOrvw%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQxJldLPTc%3d-E4KK22aKsYQ%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQxJldLPTE%3d-c5gZEYfVL2A%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQyJldLPTI%3d-h0DBR1BmE0k%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQyJldLPTM%3d-4ikdphWsuFc%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQyJldLPTQ%3d-AL6v1wrz98I%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQyJldLPTU%3d-ayEa72mHOkA%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQyJldLPTY%3d-UQLXaIqFxYk%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQyJldLPTc%3d-SGdY616OGLU%3d",
              "https://www.is.cgu.edu.tw/portal/DesktopDefault.aspx?tabid=61&tabindex=1&PS=JlRNPTQyJldLPTE%3d-kT%2bayu11rFs%3d")



##all courses

allcode<-NULL
for(a in 1:length(course_url)){
  library(stringr)
  library(rvest)
  web<-course_url[a]
  web_html<-read_html(web) %>%
    html_nodes("tr td") %>% 
    html_text()
  course_table<-data.frame(str_trim(web_html),stringsAsFactors = F)
  
  location<-grep("Seats$",web_html)+2
  course_index<-seq(location,nrow(course_table),10)
  class_index<-seq(location+1,nrow(course_table),10)
  
  course_code<-cbind(course_table[class_index,],course_table[course_index,])
  allcode<-rbind(allcode,course_code)
  Sys.sleep(runif(1,2,3))
}

#Detail
course_detail<-NULL
library(rvest) 
for(i in 1:nrow(allcode)){
  
  course_detail_url<-paste0("https://www.is.cgu.edu.tw/portal/DesktopModules/Course/CourseInfo.aspx?SID=",allcode[i,1],"&CID=",allcode[i,2])
  
  detail<-read_html(course_detail_url)  %>% 
    html_nodes(".Item") %>% 
    html_text()
  detail<-gsub("\U00A0"," ",detail)
  detail<-gsub("\r\n","",detail)
  detail<-gsub("\t","",detail)
  course_detail<- rbind(course_detail,detail)
  Sys.sleep(runif(1,2,5))
}
course_detail<-course_detail[,c(-4,-8,-9,-10,-12,-13,-16,-18,-20,-21,-22)]

course_detailDF<-data.frame(course_detail,stringsAsFactors = F)
colnames(course_detailDF)<-c("yearsemester","teacher","department","coursecode","coursetitle","serialno","time","book","referencebook","goal","description")
course_detailDF$time<-sub("^.{46}","",course_detailDF$time)
library(dplyr)
course_detailDF<-arrange(course_detailDF,course_detailDF$yearsemester,course_detailDF$department)


###############################CLEAN

#semester
course_detailDF$year<-substr(course_detailDF$yearsemester,1,3) 
course_detailDF$semester<-substr(course_detailDF$yearsemester,7,7)

#day
course_detailDF$day_ch<-substr(course_detailDF$time,1,3)   
course_detailDF$day_en<-substr(course_detailDF$time,5,7)

course_detailDF$t<-substr(course_detailDF$time,8,nchar(as.character(course_detailDF$time)))   
#class
startc<-regexec("\\(",course_detailDF$t)    
endc<-regexec("~",course_detailDF$t)
course_detailDF$start_class<-substr(course_detailDF$t,1,as.numeric(startc)-1)   
course_detailDF$start_class<-gsub("[^0-9]","",course_detailDF$start_class)
course_detailDF$end_class<-substr(course_detailDF$t,as.numeric(endc)+2,as.numeric(endc)+3)
course_detailDF$end_class<-gsub("[^0-9]","",course_detailDF$end_class)


#time
course_detailDF$start_time<-substr(course_detailDF$t,as.numeric(startc)+1,as.numeric(startc)+5)

course_detailDF$t<-substr(course_detailDF$t,as.numeric(endc)+2,nchar(as.character(course_detailDF$t)))

endt<-regexec("\\)",course_detailDF$t)
course_detailDF$end_time<-substr(course_detailDF$t,as.numeric(endt)-5,as.numeric(endt)-1)

#classroom 
roomIn<-regexec("週上課",course_detailDF$t)
course_detailDF$classroom<-substr(course_detailDF$t,as.numeric(endt)+1,as.numeric(roomIn)-2) 
#class_in_week
course_detailDF$class_in_week<-substr(course_detailDF$t,as.numeric(roomIn)-1,as.numeric(roomIn)+2)


#keyword 
noneIndex<-grep("未指定",course_detailDF$time)
course_detailDF$day_ch[noneIndex]<-"未指定"
course_detailDF$day_en[noneIndex]<-"未指定"
course_detailDF$start_class[noneIndex]<-"未指定"
course_detailDF$end_class[noneIndex]<-"未指定"
course_detailDF$start_time[noneIndex]<-"未指定"
course_detailDF$end_time[noneIndex]<-"未指定"
course_detailDF$classroom[noneIndex]<-"未指定"

peIndex<-grep("體育課",course_detailDF$time)
course_detailDF$classroom[peIndex]<-"體育課"


#credit&coursecode
course_detailDF$credit<-substr(course_detailDF$coursecode,8,8)  
course_detailDF$coursecode<-substr(course_detailDF$coursecode,1,6)
#teacher
starteng<-regexec("[A-Za-z]",course_detailDF$teacher)
course_detailDF$teacher_ch<-substr(course_detailDF$teacher,1,as.numeric(starteng)-1)
course_detailDF$teacher_ch<-gsub("\\($","",course_detailDF$teacher_ch)
course_detailDF$teacher_en<-substr(course_detailDF$teacher,as.numeric(starteng),nchar(course_detailDF$teacher))
course_detailDF$teacher_en<-gsub("not yet provided)","暫時不提供",course_detailDF$teacher_en)
#coursetitle
startengc<-regexec("[A-Za-z]",course_detailDF$coursetitle)
course_detailDF$coursetitle_ch<-substr(course_detailDF$coursetitle,1,as.numeric(startengc)-1)
course_detailDF$coursetitle_ch<-gsub("\\($","",course_detailDF$coursetitle_ch)
course_detailDF$coursetitle_en<-substr(course_detailDF$coursetitle,as.numeric(startengc),nchar(course_detailDF$coursetitle))
course_detailDF$coursetitle_en<-gsub("A)","",course_detailDF$coursetitle_en)
#department  
startengd<-regexec("[A-Za-z]",course_detailDF$department)
course_detailDF$department_ch<-substr(course_detailDF$department,1,as.numeric(startengd)-1)
course_detailDF$department_en<-substr(course_detailDF$department,as.numeric(startengd),nchar(course_detailDF$department))

#class has another time
weekIndex<-regexec("星期",course_detailDF$t)
course_detailDF$t<-substr(course_detailDF$t,as.numeric(weekIndex),nchar(course_detailDF))
course_detailDF$t[which(nchar(course_detailDF$t)<30)]<-NA

secondtimeDF<-data.frame(t=course_detailDF$t)
secondtimeDF$day_ch<-substr(secondtimeDF$t,1,3)   
secondtimeDF$day_en<-substr(secondtimeDF$t,5,7)
#class2
startc2<-regexec("\\(",secondtimeDF$t)    
endc2<-regexec("~",secondtimeDF$t)
secondtimeDF$start_class<-substr(secondtimeDF$t,8,as.numeric(startc2)-1)   
secondtimeDF$start_class<-gsub("[^0-9]","",secondtimeDF$start_class)
secondtimeDF$end_class<-substr(secondtimeDF$t,as.numeric(endc2)+2,as.numeric(endc2)+3)
secondtimeDF$end_class<-gsub("[^0-9]","",secondtimeDF$end_class)
#time2
secondtimeDF$start_time<-substr(secondtimeDF$t,as.numeric(startc2)+1,as.numeric(startc2)+5)

secondtimeDF$t<-substr(secondtimeDF$t,as.numeric(endc2)+1,nchar(as.character(secondtimeDF$t)))

endt2<-regexec("\\)",secondtimeDF$t)
secondtimeDF$end_time<-substr(secondtimeDF$t,as.numeric(endt2)-5,as.numeric(endt2)-1)

#the secondtime DF
a<-na.omit(secondtimeDF)
secondtimeDF<-course_detailDF[as.numeric(row.names(a)),c("year","semester","teacher_ch","teacher_en","department_ch","department_en","coursecode","serialno","coursetitle_ch","coursetitle_en","credit","day_ch","day_en","start_time","end_time","start_class","end_class","classroom","class_in_week","book","referencebook","goal","description")]
secondtimeDF$day_ch<-a$day_ch
secondtimeDF$day_en<-a$day_en
secondtimeDF$start_time<-a$start_time
secondtimeDF$end_time<-a$end_time
secondtimeDF$start_class<-a$start_class
secondtimeDF$end_class<-a$end_class

FinalCourseDetail<-data.frame(
  year=course_detailDF$year,
  semester=course_detailDF$semester,
  teacher_ch=course_detailDF$teacher_ch,
  teacher_en=course_detailDF$teacher_en,
  department_ch=course_detailDF$department_ch,
  department_en=course_detailDF$department_en,
  coursecode=course_detailDF$coursecode,
  serialno=course_detailDF$serialno,
  coursetitle_ch=course_detailDF$coursetitle_ch,
  coursetitle_en=course_detailDF$coursetitle_en,
  credit=course_detailDF$credit,
  day_ch=course_detailDF$day_ch,
  day_en=course_detailDF$day_en,
  start_time=course_detailDF$start_time,
  end_time=course_detailDF$end_time,
  start_class=course_detailDF$start_class,
  end_class=course_detailDF$end_class,
  classroom=course_detailDF$classroom,
  class_in_week=course_detailDF$class_in_week,
  book=course_detailDF$book,
  referencebook=course_detailDF$referencebook,
  goal=course_detailDF$goal,
  description=course_detailDF$description
)
#combine
FinalCourseDetail<-rbind(FinalCourseDetail,secondtimeDF)
FinalCourseDetail<-arrange(FinalCourseDetail,FinalCourseDetail$year,FinalCourseDetail$semester,FinalCourseDetail$department_ch,FinalCourseDetail$coursecode)


#CSV&JSON
write.csv(FinalCourseDetail,"allcourse.csv")

library(RJSONIO)
exportJSON<-toJSON(FinalCourseDetail)
write(exportJSON,"allcourse.json")



library(readr)

FinalCourseDetail <- read.csv("~/Downloads/allcourse.csv")
FinalCourseDetail<-FinalCourseDetail[,-1]

#106107年資料
library(dplyr)

course106<-filter(FinalCourseDetail,year==106)
course107<-filter(FinalCourseDetail,year==107)
course106107<-rbind(course106,course107)


##比對技能與課程

languageMatch<-c("swift","java","javascript","c\\++","c\\#","oracle","[^my]sql","mysql","unix","jquery","css","uml","ajax","python","r語言","access","資料庫","rfid","excel","大數據","vr","microsoft","windows","office","android","applet","encase","cps","app inventor 2","livecode","微積分","經濟","統計","會計","線性代數","演算法")
language<-c("Swift","Java","JavaScript","C++","C#","Oracle","SQL","MySQL","UNIX","jQuery","CSS","UML","Ajax","Python","R","Access","資料庫相關","RFID","Excel","大數據相關","VR","Microsoft","Windows","Office","Android","applet","Encase","CPS","App Inventor 2","LiveCode","微積分","經濟相關","統計相關","會計相關","線性代數","演算法")

CLALL<-NULL
CL<-NULL

for(r in 1:nrow(FinalCourseDetail)){  
  
  for(l in 1:length(languageMatch)){
    n<-grepl(languageMatch[l],FinalCourseDetail$coursetitle_ch[r])
    b<-grepl(languageMatch[l],tolower(FinalCourseDetail$book[r]))
    e<-grepl(languageMatch[l],tolower(FinalCourseDetail$referencebook[r]))
    g<-grepl(languageMatch[l],tolower(FinalCourseDetail$goal[r]))
    #d<-grepl(languageMatch[l],tolower(FinalCourseDetail$description[r]))

    
    
    if(e==TRUE|b==TRUE|g==TRUE|n==TRUE){ 
      
      CL$year<-FinalCourseDetail$year[r]
      CL$semester<-FinalCourseDetail$semester[r]
      CL$teacher<-FinalCourseDetail$teacher_ch[r]
      CL$department<-FinalCourseDetail$department_ch[r]
      CL$coursecode<-FinalCourseDetail$coursecode[r]
      CL$serialno<-FinalCourseDetail$serialno[r]
      CL$coursetitle<-FinalCourseDetail$coursetitle_ch[r]
      CL$credit<-FinalCourseDetail$credit[r]
      CL$day<-FinalCourseDetail$day_ch[r]
      CL$StartTime<-FinalCourseDetail$start_time[r]
      CL$EndTime<-FinalCourseDetail$end_time[r]
      CL$StartClass<-FinalCourseDetail$start_class[r]
      CL$EndClass<-FinalCourseDetail$end_class[r]
      CL$classroom<-FinalCourseDetail$classroom[r]
      CL$ClassWeek<-FinalCourseDetail$class_in_week[r]
      CL$book<-FinalCourseDetail$book[r]
      CL$ReferenceBook<-FinalCourseDetail$referencebook[r]
      CL$goal<-FinalCourseDetail$goal[r]
      CL$description<-FinalCourseDetail$description[r]
      CL$language<-c(CL$language," ",language[l])
      
      
    }else if(l==length(languageMatch) && length(CL$language)==0){
      CL$year<-FinalCourseDetail$year[r]
      CL$semester<-FinalCourseDetail$semester[r]
      CL$teacher<-FinalCourseDetail$teacher_ch[r]
      CL$department<-FinalCourseDetail$department_ch[r]
      CL$coursecode<-FinalCourseDetail$coursecode[r]
      CL$serialno<-FinalCourseDetail$serialno[r]
      CL$coursetitle<-FinalCourseDetail$coursetitle_ch[r]
      CL$credit<-FinalCourseDetail$credit[r]
      CL$day<-FinalCourseDetail$day_ch[r]
      CL$StartTime<-FinalCourseDetail$start_time[r]
      CL$EndTime<-FinalCourseDetail$end_time[r]
      CL$StartClass<-FinalCourseDetail$start_class[r]
      CL$EndClass<-FinalCourseDetail$end_class[r]
      CL$classroom<-FinalCourseDetail$classroom[r]
      CL$ClassWeek<-FinalCourseDetail$class_in_week[r]
      CL$book<-FinalCourseDetail$book[r]
      CL$ReferenceBook<-FinalCourseDetail$referencebook[r]
      CL$goal<-FinalCourseDetail$goal[r]
      CL$description<-FinalCourseDetail$description[r]
      CL$language<-NA
    }
    
  }
  #HTML
  hn<-grepl("HTML",FinalCourseDetail$coursetitle_ch[r])
  hb<-grepl("HTML",FinalCourseDetail$book[r])
  he<-grepl("HTML",FinalCourseDetail$referencebook[r])
  hg<-grepl("HTML",FinalCourseDetail$goal[r])
  #PHP
  pn<-grepl("PHP",FinalCourseDetail$coursetitle_ch[r])
  pb<-grepl("PHP",FinalCourseDetail$book[r])
  pe<-grepl("PHP",FinalCourseDetail$referencebook[r])
  pg<-grepl("PHP",FinalCourseDetail$goal[r])
 
  if(he==TRUE|hb==TRUE|hg==TRUE|hn==TRUE){
    CL$year<-FinalCourseDetail$year[r]
    CL$semester<-FinalCourseDetail$semester[r]
    CL$teacher<-FinalCourseDetail$teacher_ch[r]
    CL$department<-FinalCourseDetail$department_ch[r]
    CL$coursecode<-FinalCourseDetail$coursecode[r]
    CL$serialno<-FinalCourseDetail$serialno[r]
    CL$coursetitle<-FinalCourseDetail$coursetitle_ch[r]
    CL$credit<-FinalCourseDetail$credit[r]
    CL$day<-FinalCourseDetail$day_ch[r]
    CL$StartTime<-FinalCourseDetail$start_time[r]
    CL$EndTime<-FinalCourseDetail$end_time[r]
    CL$StartClass<-FinalCourseDetail$start_class[r]
    CL$EndClass<-FinalCourseDetail$end_class[r]
    CL$classroom<-FinalCourseDetail$classroom[r]
    CL$ClassWeek<-FinalCourseDetail$class_in_week[r]
    CL$book<-FinalCourseDetail$book[r]
    CL$ReferenceBook<-FinalCourseDetail$referencebook[r]
    CL$goal<-FinalCourseDetail$goal[r]
    CL$description<-FinalCourseDetail$description[r]
    CL$language<-"HTML"
  }else if(pe==TRUE|pb==TRUE|pg==TRUE|pn==TRUE){
    CL$year<-FinalCourseDetail$year[r]
    CL$semester<-FinalCourseDetail$semester[r]
    CL$teacher<-FinalCourseDetail$teacher_ch[r]
    CL$department<-FinalCourseDetail$department_ch[r]
    CL$coursecode<-FinalCourseDetail$coursecode[r]
    CL$serialno<-FinalCourseDetail$serialno[r]
    CL$coursetitle<-FinalCourseDetail$coursetitle_ch[r]
    CL$credit<-FinalCourseDetail$credit[r]
    CL$day<-FinalCourseDetail$day_ch[r]
    CL$StartTime<-FinalCourseDetail$start_time[r]
    CL$EndTime<-FinalCourseDetail$end_time[r]
    CL$StartClass<-FinalCourseDetail$start_class[r]
    CL$EndClass<-FinalCourseDetail$end_class[r]
    CL$classroom<-FinalCourseDetail$classroom[r]
    CL$ClassWeek<-FinalCourseDetail$class_in_week[r]
    CL$book<-FinalCourseDetail$book[r]
    CL$ReferenceBook<-FinalCourseDetail$referencebook[r]
    CL$goal<-FinalCourseDetail$goal[r]
    CL$description<-FinalCourseDetail$description[r]
    CL$language<-"PHP"
  }
  
  CLALL[[length(CLALL)+1]]<-CL
  CL<-NULL
}

#106107tolist
CLALL2<-NULL
CL2<-NULL

for(r in 1:nrow(course106107)){  
  
  for(l in 1:length(languageMatch)){
    b<-grepl(languageMatch[l],tolower(course106107$book[r]))
    e<-grepl(languageMatch[l],tolower(course106107$referencebook[r]))
    g<-grepl(languageMatch[l],tolower(course106107$goal[r]))
    #d<-grepl(languageMatch[l],tolower(course106107$description[r]))
    n<-grepl(languageMatch[l],course106107$coursetitle_ch[r])
    
    
    if(e==TRUE|b==TRUE|g==TRUE|n==TRUE){
      
        CL2$year<-course106107$year[r]
        CL2$semester<-course106107$semester[r]
        CL2$teacher<-course106107$teacher_ch[r]
        CL2$department<-course106107$department_ch[r]
        CL2$coursecode<-course106107$coursecode[r]
        CL2$serialno<-course106107$serialno[r]
        CL2$coursetitle<-course106107$coursetitle_ch[r]
        CL2$credit<-course106107$credit[r]
        CL2$day<-course106107$day_ch[r]
        CL2$StartTime<-course106107$start_time[r]
        CL2$EndTime<-course106107$end_time[r]
        CL2$StartClass<-course106107$start_class[r]
        CL2$EndClass<-course106107$end_class[r]
        CL2$classroom<-course106107$classroom[r]
        CL2$ClassWeek<-course106107$class_in_week[r]
        CL2$book<-course106107$book[r]
        CL2$ReferenceBook<-course106107$referencebook[r]
        CL2$goal<-course106107$goal[r]
        CL2$description<-course106107$description[r]
        CL2$language<-c(CL2$language,language[l])
      
      
    }else if(l==length(languageMatch) && length(CL2$language)==0){
      
        CL2$year<-course106107$year[r]
        CL2$semester<-course106107$semester[r]
        CL2$teacher<-course106107$teacher_ch[r]
        CL2$department<-course106107$department_ch[r]
        CL2$coursecode<-course106107$coursecode[r]
        CL2$serialno<-course106107$serialno[r]
        CL2$coursetitle<-course106107$coursetitle_ch[r]
        CL2$credit<-course106107$credit[r]
        CL2$day<-course106107$day_ch[r]
        CL2$StartTime<-course106107$start_time[r]
        CL2$EndTime<-course106107$end_time[r]
        CL2$StartClass<-course106107$start_class[r]
        CL2$EndClass<-course106107$end_class[r]
        CL2$classroom<-course106107$classroom[r]
        CL2$ClassWeek<-course106107$class_in_week[r]
        CL2$book<-course106107$book[r]
        CL2$ReferenceBook<-course106107$referencebook[r]
        CL2$goal<-course106107$goal[r]
        CL2$description<-course106107$description[r]
        CL2$language<-NA
      
      
     
    }
    
  }
  #HTML
  hn<-grepl("HTML",course106107$coursetitle_ch[r])
  hb<-grepl("HTML",course106107$book[r])
  he<-grepl("HTML",course106107$referencebook[r])
  hg<-grepl("HTML",course106107$goal[r])
  #PHP
  pn<-grepl("PHP",course106107$coursetitle_ch[r])
  pb<-grepl("PHP",course106107$book[r])
  pe<-grepl("PHP",course106107$referencebook[r])
  pg<-grepl("PHP",course106107$goal[r])
  if(he==TRUE|hb==TRUE|hg==TRUE|hn==TRUE){
    
    CL2$year<-course106107$year[r]
    CL2$semester<-course106107$semester[r]
    CL2$teacher<-course106107$teacher_ch[r]
    CL2$department<-course106107$department_ch[r]
    CL2$coursecode<-course106107$coursecode[r]
    CL2$serialno<-course106107$serialno[r]
    CL2$coursetitle<-course106107$coursetitle_ch[r]
    CL2$credit<-course106107$credit[r]
    CL2$day<-course106107$day_ch[r]
    CL2$StartTime<-course106107$start_time[r]
    CL2$EndTime<-course106107$end_time[r]
    CL2$StartClass<-course106107$start_class[r]
    CL2$EndClass<-course106107$end_class[r]
    CL2$classroom<-course106107$classroom[r]
    CL2$ClassWeek<-course106107$class_in_week[r]
    CL2$book<-course106107$book[r]
    CL2$ReferenceBook<-course106107$referencebook[r]
    CL2$goal<-course106107$goal[r]
    CL2$description<-course106107$description[r]
    CL2$language<-c(CL2$language,"HTML")
    
    
  }else if(pe==TRUE|pb==TRUE|pg==TRUE|pn==TRUE){
    
    CL2$year<-course106107$year[r]
    CL2$semester<-course106107$semester[r]
    CL2$teacher<-course106107$teacher_ch[r]
    CL2$department<-course106107$department_ch[r]
    CL2$coursecode<-course106107$coursecode[r]
    CL2$serialno<-course106107$serialno[r]
    CL2$coursetitle<-course106107$coursetitle_ch[r]
    CL2$credit<-course106107$credit[r]
    CL2$day<-course106107$day_ch[r]
    CL2$StartTime<-course106107$start_time[r]
    CL2$EndTime<-course106107$end_time[r]
    CL2$StartClass<-course106107$start_class[r]
    CL2$EndClass<-course106107$end_class[r]
    CL2$classroom<-course106107$classroom[r]
    CL2$ClassWeek<-course106107$class_in_week[r]
    CL2$book<-course106107$book[r]
    CL2$ReferenceBook<-course106107$referencebook[r]
    CL2$goal<-course106107$goal[r]
    CL2$description<-course106107$description[r]
    CL2$language<-c(CL2$language,"PHP")
    
    
    
  }

  CLALL2[[length(CLALL2)+1]]<-CL2
  CL2<-NULL
}




#toJSON_106107寫進資料庫
library(jsonlite)
json106107<-toJSON(CLALL2,pretty=TRUE)
json106107<-gsub("[ \r\n\t ]", "",json106107)
json106107<-prettify(json106107)
writeLines(json106107,"course106107.json",useBytes = T)
readLines("course106107.json",encoding="UTF-8")

library(jsonlite)
library(mongolite)
jsinsert<-json106107
class(jsinsert)
mongo<-
  mongo(collection = "courses106107", db = "newapi",url = "mongodb://localhost",
        verbose = TRUE)

mongo$insert(fromJSON(jsinsert))


#toJSON_all寫進資料庫
library(jsonlite)
jsontry<-toJSON(CLALL,pretty=TRUE)
jsontry<-gsub("[ \r\n\t ]", "",jsontry)
jsontry<-prettify(jsontry)
writeLines(jsontry,"course.json",useBytes = T)
readLines("course.json",encoding="UTF-8")

library(jsonlite)
library(mongolite)
js<-jsontry
class(js)
mongo<-
  mongo(collection = "courses", db = "newapi",url = "mongodb://localhost",
        verbose = TRUE)

mongo$insert(fromJSON(js))








#測試code
lanall<-NULL
lan<-NULL

for(r in 1:nrow(allcourse)){  
  for(l in 1:length(languageMatch)){
    b<-grepl(languageMatch[l],tolower(allcourse$book[r]))
    e<-grepl(languageMatch[l],tolower(allcourse$referencebook[r]))
    g<-grepl(languageMatch[l],tolower(allcourse$goal[r]))
    d<-grepl(languageMatch[l],tolower(allcourse$description[r]))
    n<-grepl(languageMatch[l],allcourse$coursetitle_ch[r])
    
    if(e==TRUE|b==TRUE|g==TRUE|d==TRUE|n==TRUE){ 
      
      lan$number<-r 
      lan$coursecode<-allcourse$coursecode[r]
      lan$serialno<-allcourse$serialno[r]
      lan$coursetitle<-allcourse$coursetitle_ch[r]
      lan$language<-c(lan$language,language[l])
      
    }else if(l==length(languageMatch) && length(lan$language)==0){
      lan$number<-r 
      lan$coursecode<-allcourse$coursecode[r]
      lan$serialno<-allcourse$serialno[r]
      lan$coursetitle<-allcourse$coursetitle_ch[r]
      lan$language<-""
    }
    
    
  }
  lanall[[length(lanall)+1]]<-lan
  lan<-NULL
}








